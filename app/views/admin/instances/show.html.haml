- content_for :page_title do
  = @instance.domain

- content_for :header_tags do
  = javascript_pack_tag 'admin', async: true, crossorigin: 'anonymous'

- content_for :heading_actions do
  = l(@time_period.first)
  = ' - '
  = l(@time_period.last)

.dashboard
  .dashboard__item
    = react_admin_component :counter, measure: 'instance_accounts', start_at: @time_period.first, end_at: @time_period.last, params: { domain: @instance.domain }, label: t('admin.instances.dashboard.instance_accounts_measure'), href: admin_accounts_path(origin: 'remote', by_domain: @instance.domain)
  .dashboard__item
    = react_admin_component :counter, measure: 'instance_media_attachments', start_at: @time_period.first, end_at: @time_period.last, params: { domain: @instance.domain }, label: t('admin.instances.dashboard.instance_media_attachments_measure')
  .dashboard__item
    = react_admin_component :counter, measure: 'instance_reports', start_at: @time_period.first, end_at: @time_period.last, params: { domain: @instance.domain }, label: t('admin.instances.dashboard.instance_reports_measure'), href: admin_reports_path(by_target_domain: @instance.domain)

%hr.spacer/

%h3= t('admin.instances.availability')

%ul.availability-indicator
  - failure_date_map = @exhausted_deliveries_days.index_with { true }
  - (@time_period.first..@time_period.last).each do |date|
    %li.availability-indicator__item{ class: failure_date_map[date] ? 'negative' : 'neutral', title: l(date) }

%p
  = @instance.delivery_failure_tracker.days
  different days without successful delivery.
  = t('admin.instances.delivery_error_hint', count: DeliveryFailureTracker::FAILURE_DAYS_THRESHOLD)

- if @instance.private_comment.present?
  .speech-bubble
    .speech-bubble__bubble
      = simple_format(h(@instance.private_comment))
    .speech-bubble__owner= t 'admin.instances.private_comment'

- if @instance.public_comment.present?
  .speech-bubble
    .speech-bubble__bubble
      = simple_format(h(@instance.public_comment))
    .speech-bubble__owner= t 'admin.instances.public_comment'

%hr.spacer/

%div.action-buttons
  %div
    - if @instance.domain_allow
      = link_to t('admin.domain_allows.undo'), admin_domain_allow_path(@instance.domain_allow), class: 'button button--destructive', data: { confirm: t('admin.accounts.are_you_sure'), method: :delete }
    - elsif @instance.domain_block
      = link_to t('admin.domain_blocks.edit'), edit_admin_domain_block_path(@instance.domain_block), class: 'button'
      = link_to t('admin.domain_blocks.undo'), admin_domain_block_path(@instance.domain_block), class: 'button'
    - else
      = link_to t('admin.domain_blocks.add_new'), new_admin_domain_block_path(_domain: @instance.domain), class: 'button'
    - if @instance.delivery_failure_tracker.available?
      - unless @exhausted_deliveries_days.empty?
        = link_to t('admin.instances.delivery.clear'), clear_delivery_errors_admin_instance_path(@instance), data: { confirm: t('admin.accounts.are_you_sure'), method: :post }, class: 'button'
      = link_to t('admin.instances.delivery.stop'), stop_delivery_admin_instance_path(@instance), data: { confirm: t('admin.accounts.are_you_sure'), method: :post }, class: 'button'
    - else
      = link_to t('admin.instances.delivery.restart'), restart_delivery_admin_instance_path(@instance), data: { confirm: t('admin.accounts.are_you_sure'), method: :post }, class: 'button'
    - if !@instance.delivery_failure_tracker.available? || @instance.accounts_count.zero? || @instance.domain_block&.suspend?
      = link_to t('admin.instances.purge'), admin_instance_path(@instance), data: { confirm: t('admin.instances.confirm_purge'), method: :delete }, class: 'button'
